<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:bw="http://www.scc.kit.edu/bwfacelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:of="http://omnifaces.org/functions">
<head>
<title></title>
</head>
<body>

<f:view>
<f:metadata>
	<f:event type="javax.faces.event.PreRenderViewEvent"
           listener="#{userPropertiesBean.preRenderView}" />
</f:metadata>

<ui:composition template="/template/default.xhtml">
	<ui:param name="title" value="#{messages.title}"/>

	<ui:define name="content">
	<h:form id="form" prependId="false" class="full form">

	<div class="panel">
		<p:panel rendered="#{userPropertiesBean.userList.size() gt 1}">
			<p:outputLabel for="@next" value="Choose account: " />
			<p:selectOneMenu id="userSelect" value="#{userPropertiesBean.user}" converter="#{userConverter}">
    	        <f:selectItems value="#{userPropertiesBean.userList}" var="user" itemLabel="#{user.eppn}" itemValue="#{user}" />
	        </p:selectOneMenu>
		</p:panel>
		<p:tabView id="tabVw" dynamic="true" cache="true">
			<p:tab id="tab1" title="#{messages.my_data}">
				<div class="panel">#{messages.my_data_explanation}</div>
				<div class="panel">#{messages.data_from}: <b>#{userPropertiesBean.idpEntity.orgName}</b></div>
				<p:panelGrid id="baseData" columns="2">
					<bw:outputText label="#{messages.name}" value="#{userPropertiesBean.user.surName}, #{userPropertiesBean.user.givenName}"/>
					<bw:outputText label="#{messages.email}" value="#{userPropertiesBean.user.email}"/>
					<bw:outputText label="#{messages.eppn}" value="#{userPropertiesBean.user.eppn}"/>
					<bw:outputText label="#{messages.persistent_id}" value="#{userPropertiesBean.user.persistentId}" rendered="#{userPropertiesBean.user.class eq 'SamlUserEntity'}"/>
					<bw:outputText label="#{messages.uid_number}" value="#{userPropertiesBean.user.uidNumber}"/>
					<bw:outputText label="#{messages.primary_group}" value="#{userPropertiesBean.user.primaryGroup.name} (#{userPropertiesBean.user.primaryGroup.gidNumber})"/>
					
					<bw:outputText label="#{messages.idp}" value="#{userPropertiesBean.idpEntity.displayName}"
						rendered="#{not empty userPropertiesBean.idpEntity and not empty userPropertiesBean.idpEntity.displayName}"/>
					
				</p:panelGrid>
				<div class="panel">#{messages.my_data_delete_all}
				</div>
				<div class="panel">
					<h:link outcome="/user/delete-all-personal-data.xhtml" value="#{messages.my_data_delete_all_link}">
					</h:link>
				</div>
			</p:tab>

			<p:tab id="tab2" title="#{messages.shibboleth}">
				<div class="panel">#{messages.my_data_from_saml} #{of:formatDate(userPropertiesBean.user.lastUpdate, 'dd.MM.yyyy HH:mm')}</div>
				<p:dataTable id="attrData" style="min-width: 500px;" 
						value="#{userPropertiesBean.user.attributeStore.keySet().toArray()}" var="key">
					<p:column>
						<f:facet name="header">
							<h:outputText value="#{messages.name}" />
						</f:facet>
						<h:outputText value="#{key}" style="font-size: 80%;" />
					</p:column>
					<p:column>
						<f:facet name="header">
							<h:outputText value="#{messages.value}" />
						</f:facet>
						<h:outputText value="#{userPropertiesBean.user.attributeStore.get(key)}" />
					</p:column>						
				</p:dataTable>
			</p:tab>

			<p:tab id="tab3" title="#{messages.groups}">
				<div class="panel">#{messages.my_data_groups}</div>
				<p:dataTable id="secGroupData" style="min-width: 500px;" 
						value="#{userPropertiesBean.groupList}" var="group">
					<p:column>
						<f:facet name="header">
							<h:outputText value="#{messages.name}" />
						</f:facet>
						<h:outputText value="#{group.class.simpleName}: #{group.name} " />
						<h:outputText value="(#{group.prefix})" rendered="#{group.class.simpleName == 'HomeOrgGroupEntity'}" />
					</p:column>
					<p:column>
						<f:facet name="header">
							<h:outputText value="#{messages.id}" />
						</f:facet>
						<h:outputText value="#{group.gidNumber}" />
					</p:column>
				</p:dataTable>
			</p:tab>
									
		</p:tabView>
	</div>
	</h:form>
	</ui:define>
</ui:composition>
</f:view>
</body>
</html>
