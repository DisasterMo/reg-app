<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">
<head>
<title></title>
</head>
<body>
	<f:metadata>
		<f:event type="javax.faces.event.PreRenderViewEvent"
            listener="#{discoveryLoginBean.preRenderView}" />
	</f:metadata>

<ui:composition template="/template/default.xhtml">
	<ui:param name="title" value="#{messages.title}"/>

	<ui:define name="metadata">
		<meta http-equiv="refresh" content="600;url=index.xhtml" />	
	</ui:define>

	<ui:define name="content">

	<h:form id="form" prependId="false" class="full form">
		<h3><h:outputText value="#{messages.welcome}"/></h3>
		<p:panel>
			<p:outputPanel rendered="#{empty discoveryLoginBean.spMetadata and empty discoveryLoginBean.clientConfig}" style="margin-top: 8px;">
				<h:outputText value="#{messages.welcome_disco}"/>
			</p:outputPanel>
			
			<p:outputPanel rendered="#{not empty discoveryLoginBean.spMetadata}" style="margin-top: 8px;">
				<h:outputText value="#{messages.welcome_redirected}" /><br/>
				<b>
					<h:outputText value="#{discoveryLoginBean.spMetadata.displayName}" rendered="#{not empty discoveryLoginBean.spMetadata.displayName}" />
					<h:outputText value="#{discoveryLoginBean.spMetadata.entityId}" rendered="#{empty discoveryLoginBean.spMetadata.displayName}" />
				</b>			
			</p:outputPanel>

			<p:outputPanel rendered="#{not empty discoveryLoginBean.clientConfig}" style="margin-top: 8px;">
				<h:outputText value="#{messages.welcome_redirected}" /><br/> 
				<b> 
					<h:outputText value="#{discoveryLoginBean.clientConfig.displayName}" rendered="#{not empty discoveryLoginBean.clientConfig.displayName}" />
					<h:outputText value="#{discoveryLoginBean.clientConfig.name}" rendered="#{empty discoveryLoginBean.clientConfig.displayName}" />
				</b>
			</p:outputPanel>

			<div><p:messages showDetail="true" /></div>

			<p:focus conext="baseData" for="filterText" />

			<h:panelGrid id="baseData" columns="2" style="margin-top: 8px;" columnClasses="col-width-1,col-width-2">	
	
				<p:outputLabel value="#{messages.federation}:" for="selectFed" />
		        <p:selectOneMenu id="selectFed" value="#{discoveryLoginBean.selectedFederation}"
		        	converter="#{federationConverter}" >
		        	<f:selectItem itemLabel="#{messages.all}" itemValue="#{null}"/>
	            	<f:selectItems value="#{discoveryLoginBean.federationList}" 
	            		var="federation" itemLabel="#{federation.name} (id #{federation.id})" itemValue="#{federation}"/>
	            	<f:ajax execute="@this" render="idpBox" event="change" />
	            </p:selectOneMenu>
	
				<p:outputLabel value="#{messages.search_filter}:" for="filterText" />
				<p:inputText value="#{discoveryLoginBean.filter}" id="filterText" >
					<f:ajax event="keyup" execute="@this" render="idpBox" />
				</p:inputText>
				
				<p:outputLabel value="#{messages.home_org}:" for="idpBox" />
				<p:selectOneListbox id="idpBox" value="#{discoveryLoginBean.selectedIdp}" scrollHeight="360" style="width:auto;"
						converter="#{samlIdpMetadataConverter}">
	            	<f:selectItems value="#{discoveryLoginBean.idpList}" 
	            		var="idp" itemLabel="#{idp.displayName == null ? idp.orgName : idp.displayName}" itemValue="#{idp}"/>
					<p:ajax event="dblclick" listener="#{discoveryLoginBean.login}" update=":form" />	            		
				</p:selectOneListbox>
				
			</h:panelGrid>
	
			<p:commandButton id="login" action="#{discoveryLoginBean.login}" value="#{messages.proceed}"
				update=":form" />
		</p:panel>

		<p:panel header="OIDC Test" rendered="#{'true'.equalsIgnoreCase(discoveryLoginBean.appConfig.getConfigValue('show_oidc_login'))}" styleClass="full">
			<h:panelGrid id="oidcBaseData" columns="2" style="margin-top: 8px;">
				<p:outputLabel value="#{messages.home_org}:" for="oidcBox" />
				<p:selectOneListbox id="oidcBox" value="#{discoveryLoginBean.selectedOidcRp}" scrollHeight="120" style="width:300px;"
						converter="#{oidcRpConfigurationConverter}">
	            	<f:selectItems value="#{discoveryLoginBean.oidcRpList}" 
	            		var="rp" itemLabel="#{rp.displayName}" itemValue="#{rp}"/>
					<p:ajax event="dblclick" listener="#{discoveryLoginBean.oidcLogin()}" update=":form" />	            		
				</p:selectOneListbox>
			</h:panelGrid>
				
			<p:commandButton id="oidcLogin" action="#{discoveryLoginBean.oidcLogin()}" value="#{messages.proceed}" 
				update=":form"/>
		</p:panel>
	</h:form>
	
	</ui:define>
</ui:composition>
</body>
</html>
